@model TherapyDashboard.ViewModels.MasterViewModel
@{
    ViewBag.Title = "Home Page";
}

<head>
    <style>
        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            height: 50%;
        }

        #piechart {
            width: 30%;
            float: left;
        }

        #barchart {
            width: 30%;
            float: left;
        }

        #selectedPatients {
            width: 30%;
            float: left;
            margin-left: 100px;
        }
        
        .popup {
            display:none;
            position:absolute;
            border:1px solid #000;
            background: white;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://rawgithub.com/smart-on-fhir/client-js/master/dist/fhir-client.js"></script>

</head>

<!-- TODO bootstrap grid this -->
<div style="height: 700px">
    <div style="height: 10px;"></div>
    <div style="height: 300px">
        <div id="piechart" style="height: 100%;"></div>
        <div id="barchart" style="height: 100%;"></div>

        <div id="selectedPatients" style ="height: 300px; overflow-x: hidden;">      
            <h4>Warnings</h4>
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Reason</th>
                    </tr>
                </thead>
                <tbody id="warningTable">

            </table>
        </div>
    </div>

    <!-- TODO move these-->
    <script src="~/Scripts/Custom/MasterView/PieChart.js"></script>
    <script src="~/Scripts/Custom/MasterView/PatientModuleChart.js"></script>

    <div>
        <div id="tableHead">
            <h2>Your patients</h2>
            <input class="form-control" id="patientFilter" type="text" placeholder="Search..">
            
            <button type="button" class="btn btn-primary" onclick="clearFilter()">All</button>
            <button type="button" class="btn btn-primary" onclick="filterDone()">Not checked</button>
            <button type="button" class="btn btn-primary" onclick="filterNotDone()">Checked</button>
        </div>

        <table class="table table-hover table-striped" id="masterTable">
            <thead>
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Time spent in program</th>
                    <th scope="col">Flags</th>
                    <th scope="col">Summary</th>
                    <th scope="col">Last checked</th>
                </tr>
            </thead>
            
            <tbody id="masterTableBody"></tbody>

        </table>
    </div>

</div>
<script>
    var _summaries = @Html.Raw(Json.Encode(@Model.summaries));
    //console.log(summaries);
    var _patientNames = @Html.Raw(Json.Encode(@Model.patientNames));
    //console.log(_patientNames);
    var _flags = @Html.Raw(Json.Encode(@Model.flags));
    var _warnings = @Html.Raw(Json.Encode(@Model.warnings));
    //console.log(_warnings);
    var _lastChecked = @Html.Raw(Json.Encode(@Model.lastCheckedMap));
    //console.log(_lastChecked);
    var _earliestQRDates = @Html.Raw(Json.Encode(@Model.earliestQRDate));
    
</script>
<script src="~/Scripts/Custom/FhirRepository.js"></script>
<script src="~/Scripts/Custom/MasterView/TableController.js"></script>